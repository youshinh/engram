# **【資料4/8】主要UIコンポーネント詳細設計書 (v1.1)**

## **1\. 概要**

本資料は、【資料3/8】フロントエンド基本設計書\[cite: engram\_frontend\_basic\_design\_v1.1.md\]に基づき、主要UIコンポーネントの内部構造、状態、イベントハンドラ、および具体的なスタイリング（すりガラス効果\[cite: d.png, l.png, engram\_frontend\_basic\_design\_v1.1.md\]）を詳細に定義する。

**v1.1の主な変更点:**

* Engrammer（旧ACE\[cite: aceFlow, HelpModal.tsx\]）対話UIを、LangGraph 1.0\[cite: LangChain/LangGraph 1.0 詳細調査計画\]の非同期・HITLフロー\[cite: LangChain/LangGraph 1.0 詳細調査計画\]に対応した EngrammerFlow.tsx として新設・詳細化する。  
* ConnectionsPage.tsx\[cite: ConnectionsPage.tsx\]を、リスト表示からReact Flowを使用したグラフビュー実装\[cite: 複合機能提案\]に全面的に変更する。  
* NoteInput.tsx\[cite: NoteInput.tsx\]に複合機能（スケッチ、3Dモデル等）のUIトリガーを追加する。  
* NotesPage.tsx\[cite: NotesPage.tsx\]にコンテキスト機能（関連バッジ、思考を深めるボタン）を追加する。  
* 「プロジェクト」機能（ProjectPage.tsx）のUIを新設する。

## **2\. グローバルスタイル (index.css / App.css)**

LLMは、以下のグローバルスタイルが定義されている前提でコンポーネントを生成すること。

/\* \=== :root (グローバルCSS変数) \=== \*/  
:root {  
  /\* フォント \*/  
  \--font-family-sans: 'Inter', 'Noto Sans JP', sans-serif;  
    
  /\* Light Theme (l.png参照) \*/  
  \--color-bg-light: \#F4F4F7;  
  \--color-text-light: \#1A1A1A;  
  \--color-text-subtle-light: \#555555;  
  \--color-border-light: rgba(255, 255, 255, 0.4);  
  \--color-glass-bg-light: rgba(255, 255, 255, 0.65);  
  \--color-accent-light: \#007AFF;

  /\* Dark Theme (d.png参照) \*/  
  \--color-bg-dark: \#121212;  
  \--color-text-dark: \#E0E0E0;  
  \--color-text-subtle-dark: \#AAAAAA;  
  \--color-border-dark: rgba(255, 255, 255, 0.15);  
  \--color-glass-bg-dark: rgba(30, 30, 30, 0.65);  
  \--color-accent-dark: \#0A84FF;  
}

body {  
  font-family: var(--font-family-sans);  
  margin: 0;  
  padding: 0;  
  transition: background-color 0.3s ease, color 0.3s ease;  
}

body.light-theme {  
  background-color: var(--color-bg-light);  
  color: var(--color-text-light);  
}  
body.dark-theme {  
  background-color: var(--color-bg-dark);  
  color: var(--color-text-dark);  
}

/\* \=== .glass-card (すりガラス効果) \=== \*/  
.glass-card {  
  /\* すりガラス効果 (Glassmorphism) \*/  
  backdrop-filter: blur(16px) saturate(180%);  
  \-webkit-backdrop-filter: blur(16px) saturate(180%);  
    
  border-radius: 16px; /\* 角丸 \*/  
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);  
  transition: background-color 0.3s ease, border 0.3s ease;  
}

body.light-theme .glass-card {  
  background-color: var(--color-glass-bg-light);  
  border: 1px solid var(--color-border-light);  
}

body.dark-theme .glass-card {  
  background-color: var(--color-glass-bg-dark);  
  border: 1px solid var(--color-border-dark);  
}

## **3\. コンポーネント詳細設計 (v1.1)**

### **3.1. NoteInput.tsx (v1.1)**

* **責務:** マルチモーダル入力の受付\[cite: NoteInput.tsx\]。複合機能（スケッチ、3Dモデル、URL、テンプレート）へのトリガー。  
* **状態:** content: string, isListening: boolean, isCameraActive: boolean\[cite: NoteInput.tsx\]等。  
* **UI構造:**  
  * メイン入力: textarea。  
  * アクションバー (.actions-bar):  
    * 左側（ツール群）:  
      * mic (音声入力)\[cite: NoteInput.tsx\]  
      * add\_photo\_alternate (画像/3Dモデル)\[cite: NoteInput.tsx\]  
      * photo\_camera (カメラ)\[cite: NoteInput.tsx\]  
      * **draw (スケッチ \- 新規):** WorkshopInputModal（スケッチタブ）を開く。  
      * **link (URL \- 新規):** URL入力プロンプトを表示。ペーストされた場合、自動でtype: 'url'\[cite: engram\_database\_design\_v1.1\_updated.ts\]として処理。  
      * **browse\_templates (テンプレート \- 新規):** テンプレート選択モーダルを開く。  
    * 右側（実行）:  
      * send (ノート追加)\[cite: NoteInput.tsx\]

### **3.2. MainPage.tsx (v1.1)**

* **責務:** メイン画面のレイアウト。NoteInput.tsxとEngrammerFlow.tsxを配置する。  
* **UI構造:**  
  * .main-page-layout (CSS Grid or Flex)  
    * 上部: \<NoteInput onAddNote={...} /\>  
    * 下部: \<EngrammerFlow onTriggerAction={...} /\> (新設)

### **3.3. EngrammerFlow.tsx (v1.1 新規)**

* **責務:** 【資料3/8】\[cite: engram\_frontend\_basic\_design\_v1.1.md\]で定義されたEngrammerとの非同期・HITL\[cite: LangChain/LangGraph 1.0 詳細調査計画\]対話フローを管理するUI。  
* **Props:**  
  * sessionState: EngrammerSessionState | null (App.tsx\[cite: App.tsx\]から渡される現在のセッション状態\[cite: engram\_frontend\_basic\_design\_v1.1.md\])  
  * onQuerySubmit: (query: string) \=\> void (callEngrammerFlow\[cite: App.tsx\]をトリガー)  
  * onHitlResponse: (threadId: string, response: "approve" | "deny") \=\> void (continueEngrammerFlow\[cite: engram\_ace\_integration\_design.md\]をトリガー)  
  * onRefClick: (noteId: string) \=\> void (handleFeedbackClick\[cite: App.tsx\]を呼び出し)  
* **内部ロジック (renderContent):** sessionState?.status\[cite: engram\_frontend\_basic\_design\_v1.1.md\]に基づき、表示を動的に切り替える。  
  * **case 'idle' (または sessionState \=== null):**  
    * .glass-card のコンテナを表示。  
    * textarea（engrammerQuery\[cite: MainPage.tsx\]）と「送信」ボタンを表示。「Insight Bloom: Ask Engrammer...」\[cite: MainPage.tsx\]のプレースホルダー。  
  * **case 'generating':**  
    * InsightBloomAnimation\[cite: InsightBloomAnimation.tsx\]を表示（isAnimating={true}）。  
    * 「Engrammerが分析中...」というテキストとローディングスピナーを表示。  
  * **case 'pending\_input' (HITL対応):**  
    * InsightBloomAnimation\[cite: InsightBloomAnimation.tsx\]を停止（isAnimating={false}）。  
    * 応答（sessionState.markdownContent）をReactMarkdown\[cite: MainPage.tsx\]で表示。  
    * 参照ノート（sessionState.feedbackRefs\[cite: engram\_frontend\_basic\_design\_v1.1.md\]）を「Ref」ボタン\[cite: MainPage.tsx\]として表示。  
    * **HITL UI (改善案\#1):** sessionState.hitlPrompt（例: 「この洞察を学習させますか？」）を表示し、その下に「**学習させる (Approve)**」「させない (Deny)」ボタンを配置する。  
  * **case 'learning':**  
    * 応答（markdownContent）は表示したまま。  
    * 「学習中...」という小さなインジケーターをHITLボタンの代わりに表示する。  
  * **case 'done':**  
    * 応答（markdownContent）と「Ref」ボタンを表示。  
    * Engrammerとの対話が完了したことを示す（例: チェックマーク）。  
  * **case 'error':**  
    * sessionState.errorMessage をエラー表示（赤色）する。

### **3.4. ConnectionsPage.tsx (v1.1)**

* **責務:** Relation\[cite: data-model.md\]をリスト表示\[cite: ConnectionsPage.tsx\]するのではなく、React Flowを使用したインタラクティブなグラフビュー\[cite: 複合機能提案\]として表示する。  
* **ライブラリ:** reactflow を使用する。  
* **ロジック:**  
  1. useLiveQuery\[cite: App.tsx\]でallNotes\[cite: App.tsx\]とallRelations\[cite: App.tsx\]を取得。  
  2. useEffectフック内で、allNotesをReact FlowのNodeオブジェクトの配列に変換する。  
     * 各ノードは .glass-card スタイルを適用。  
     * NodeのdataプロパティにNote\[cite: db.ts\]の要約（テキスト、画像サムネイル）を含める。  
  3. allRelationsをEdgeオブジェクトの配列に変換する。  
  4. 「リアルタイムInsight Bloom」（提案\#4複合）の実装:  
     * allRelationsの数が変化した際、新しいEdgeにanimated: trueプロパティを設定し、アニメーション（点線が流れるなど）で表示する。  
* **UI構造:**  
  * \<ReactFlow nodes={nodes} edges={edges} ...\>  
  * \<Background /\> (背景グリッド)  
  * \<Controls /\> (ズーム/パン制御)

### **3.5. NotesPage.tsx (v1.1)**

* **責務:** ノート一覧の表示\[cite: NotesPage.tsx\]。v1.1でコンテキスト機能を追加。  
* **UI構造 (変更点のみ):**  
  * 各ノートカード（.glass-card\[cite: NotesPage.tsx\]）のフッターに以下を追加:  
    * **「関連: (X件)」バッジ (提案\#6 UX):** allRelations\[cite: App.tsx\]からこのノートID（sourceId\[cite: data-model.md\]またはtargetId\[cite: data-model.md\]）を持つRelation\[cite: data-model.md\]の数をカウントし表示。クリックで関連ノート一覧モーダルを開く。  
    * **「深める」ボタン (提案\#6複合):** (icon: "auto\_awesome") アイコンボタン。クリックするとApp.tsx\[cite: App.tsx\]のhandleDeepenNote(noteId)を呼び出す。  
      * handleDeepenNoteは、view\[cite: App.tsx\]を'main'に戻し、Engrammer\[cite: engram\_frontend\_basic\_design\_v1.1.md\]のクエリ入力欄に「このノートについて深掘りして：\[ノート内容の要約\]」と自動入力し、callEngrammerFlow\[cite: App.tsx\]を実行する。

### **3.6. ProjectPage.tsx (v1.1 新規)**

* **責務:** 「プロジェクト」ノート（type \=== 'project'\[cite: engram\_database\_design\_v1.1\_updated.ts\]）の詳細ビュー（提案\#1複合）。  
* **Props:** projectId: string  
* **ロジック:**  
  1. useLiveQuery\[cite: App.tsx\]を使い、db.notes.get(projectId)\[cite: db.ts\]でプロジェクトノート本体を取得。  
  2. useLiveQuery\[cite: App.tsx\]を使い、db.notes.where('projectId').equals(projectId)\[cite: engram\_database\_design\_v1.1\_updated.ts\]で関連ノート一覧を取得。  
* **UI構造:**  
  * ヘッダー: プロジェクト名（プロジェクトノートのcontent\[cite: data-model.md\]）。  
  * メインエリア (2カラムレイアウト):  
    * 左側: EngrammerFlow.tsx（コンテキストをこのprojectId\[cite: engram\_database\_design\_v1.1\_updated.ts\]に限定するPropsを渡す）を配置（提案\#6複合）。  
    * 右側: 関連ノート一覧をNotesPage.tsx\[cite: NotesPage.tsx\]（簡易版）のように表示する。

### **3.7. WorkshopInputModal.tsx (v1.1 新規)**

* **責務:** NoteInput.tsx\[cite: NoteInput.tsx\]からトリガーされる「ワークショップ」入力モーダル（提案\#3複合）。  
* **UI構造:**  
  * タブUI: 「スケッチ\[cite: 複合機能提案\]」「3Dモデル\[cite: 複合機能提案\]」「音声\[cite: NoteInput.tsx\]」  
  * 「スケッチ」タブ: react-canvas-draw等のライブラリを用いた描画エリア。  
  * 「3Dモデル」タブ: ファイルドロップゾーン。アップロード後、@react-three/fiberと@react-three/drei（useGLTF等）を用いて.stl\[cite: 複合機能提案\]または.obj\[cite: 複合機能提案\]モデルのプレビューを表示。  
  * フッター: 「ノートに追加」ボタン。