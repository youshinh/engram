# **【資料8/8】開発・実行環境設定ガイド (v1.1)**

## **1\. 概要**

本資料は、en:gram アプリケーションの開発環境をセットアップし、ローカルで実行するための手順を定義する。フロントエンド (Vite \+ React)、バックエンド (Firebase Functions / Emulators)、および Chrome 拡張機能の開発環境構築を対象とする。

LLM（AI開発エージェント）は、コード生成時に本ガイドで指定されたツールバージョンと言語（TypeScript）を前提とし、必ず engram\_llm\_development\_guidelines\_en.md に従うこと。

**v1.1 での主な変更点:**

* **Engrammer の統合:** LangGraph 1.0\[cite: LangChain/LangGraph 1.0 詳細調査計画\] ベースの Engrammer\[cite: engram\_backend\_api\_design\_v1.1.ts\] は Firebase Functions に統合されたため、独立した npm run ace\[cite: quickstart.md\] (Express サーバー) プロセスは**不要**となった。  
* **Emulator の拡張:** Firebase Emulators は、functions に加え、firestore (Checkpointer\[cite: LangChain/LangGraph 1.0 詳細調査計画\]用) と auth (API認証用) も起動するよう構成する。  
* **Chrome 拡張機能:** 拡張機能のローカル開発手順を追加。

## **2\. 必須ツールとバージョン**

* **Node.js:** v20.0.0 以上  
* **npm:** v10.0.0 以上  
* **Firebase CLI:** 最新版 (npm install \-g firebase-tools)  
* **Google Chrome:** 最新版 (オンデバイスAIテスト用)  
* **Vite:** 最新版  
* **TypeScript:** \~5.x

## **3\. プロジェクト構造 (v1.1)**

モノリポ構成は維持するが、engram-app (フロントエンド) と extension (拡張機能) を明確に分離する。

/ (リポジトリルート)  
├── engram-app/           \# フロントエンド (React SPA)  
│   ├── src/  
│   │   ├── components/  
│   │   ├── hooks/  
│   │   ├── pages/  
│   │   ├── App.tsx  
│   │   ├── db.ts         \# (資料2/8)\[cite: engram\_database\_design\_v1.1.md\]  
│   │   ├── firebase.ts  
│   │   └── ...  
│   ├── public/  
│   ├── package.json  
│   ├── vite.config.ts  
│   └── .env.local        \# (4.1. 参照)  
│  
├── functions/            \# バックエンド (Firebase Functions)  
│   ├── src/  
│   │   ├── index.ts      \# (資料7/8)\[cite: engram\_backend\_api\_design\_v1.1.ts\] (API定義)  
│   │   ├── engrammer/    \# (LangGraph グラフ定義)  
│   │   │   ├── index.ts  
│   │   │   ├── agents.ts  
│   │   │   └── nodes.ts  
│   │   └── utils/  
│   ├── package.json  
│   └── .env              \# (4.1. 参照)  
│  
├── extension/            \# Chrome 拡張機能 (Web Clipper)  
│   ├── src/  
│   │   ├── content.ts  
│   │   └── background.ts  
│   ├── public/  
│   │   ├── manifest.json  
│   │   └── icons/  
│   └── package.json  
│  
├── firebase.json         \# (Emulator 設定含む)  
└── .firebaserc

## **4\. 環境設定**

### **4.1. 環境変数 (.env)**

開発者は、LLMが生成したコードを実行する前に、以下の場所に .env ファイルを作成し、必要なキーを設定する必要がある。

1\. フロントエンド (/engram-app/.env.local):  
Vite がローカル開発サーバー (npm run dev) で使用する。  
\# Vite が import.meta.env.VITE\_... で読み込む  
VITE\_FIREBASE\_API\_KEY="\<YOUR\_FIREBASE\_API\_KEY\>"  
VITE\_FIREBASE\_AUTH\_DOMAIN="\<YOUR\_FIREBASE\_PROJECT\_ID\>.firebaseapp.com"  
VITE\_FIREBASE\_PROJECT\_ID="\<YOUR\_FIREBASE\_PROJECT\_ID\>"  
VITE\_FIREBASE\_STORAGE\_BUCKET="\<YOUR\_FIREBASE\_PROJECT\_ID\>.appspot.com"  
VITE\_FIREBASE\_MESSAGING\_SENDER\_ID="\<YOUR\_SENDER\_ID\>"  
VITE\_FIREBASE\_APP\_ID="\<YOUR\_APP\_ID\>"

2\. バックエンド (/functions/.env):  
Firebase Functions がローカル（Emulator）およびデプロイ時に使用する。  
\# Firebase Functions (Node.js) が process.env... で読み込む  
\# Google AI Studio または Vertex AI の API キー  
GOOGLE\_API\_KEY="\<YOUR\_GOOGLE\_AI\_API\_KEY\>"

\# (Engrammer が外部ツールを使う場合)  
\# TAVILY\_API\_KEY="\<YOUR\_TAVILY\_API\_KEY\>"

### **4.2. Firebase Emulators (firebase.json)**

firebase.json に、Engrammer\[cite: engram\_backend\_api\_design\_v1.1.ts\] の動作（functions）、Checkpointer\[cite: LangChain/LangGraph 1.0 詳細調査計画\] の動作（firestore）、API認証（auth）に必要な設定を定義する。

{  
  "functions": {  
    "source": "functions",  
    "runtime": "nodejs20" // Node.js 20 を指定  
  },  
  "firestore": {  
    "rules": "firestore.rules",  
    "indexes": "firestore.indexes.json"  
  },  
  "emulators": {  
    "auth": {  
      "port": 9099  
    },  
    "functions": {  
      "port": 5001,  
      "runtime": "nodejs20"  
    },  
    "firestore": {  
      "port": 8080  
    },  
    "ui": {  
      "enabled": true,  
      "port": 4000  
    },  
    "singleProjectMode": true  
  }  
}

### **4.3. オンデバイスAI (Chrome Flags)**

en:gram の第一経路であるオンデバイスAI (getInsightSuggestions\[cite: engram\_client\_ai\_logic\_v1.1.md\] 内) をテストするため、開発者は Google Chrome で以下を設定する必要がある。

1. chrome://flags にアクセス。  
2. \#prompt-api-for-gemini-nano（または同等のフラグ）を Enabled に設定。  
3. ブラウザを再起動。  
4. （初回）chrome://components を開き、「Optimization Guide On Device Model」がダウンロードされるのを待つ。

## **5\. ローカルでの実行手順**

開発中は、**ターミナルを3つ**（またはそれ以上）開いて、各プロセスを並行して実行する。

### **ターミナル 1: Firebase Emulators (バックエンド)**

Engrammer\[cite: engram\_backend\_api\_design\_v1.1.ts\] (Functions) と Checkpointer\[cite: LangChain/LangGraph 1.0 詳細調査計画\] (Firestore) を起動する。

\# / (リポジトリルート) から実行  
cd functions  
npm install \# 初回のみ

cd ..  
firebase emulators:start \--only functions,firestore,auth  
\# (Emulator UI は http://localhost:4000 で起動)

* functions が http://localhost:5001 で起動する。  
* firestore が http://localhost:8080 で起動する。

### **ターミナル 2: フロントエンド (Vite)**

en:gram の Web アプリケーション本体を起動する。

\# / (リポジトリルート) から実行  
cd engram-app  
npm install \# 初回のみ  
npm run dev

* アプリケーションが http://localhost:5173（または別のポート）で起動する。  
* engram-app/src/firebase.ts\[cite: firebase.ts\] 内の connectFunctionsEmulator\[cite: firebase.ts\] と connectFirestoreEmulator が、ターミナル1の Emulator に自動的に接続する。

### **ターミナル 3: Chrome 拡張機能 (Vite Watch)**

Web Clipper 機能\[cite: 複合機能提案\]（extension/ ディレクトリ）を開発する場合。

\# / (リポジトリルート) から実行  
cd extension  
npm install \# 初回のみ  
npm run dev \# (vite build \--watch)  
