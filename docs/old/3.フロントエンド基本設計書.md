# **en:gram フロントエンド基本設計書**

バージョン: 1.0  
作成日: 2025-10-29  
**目的:**

* en:gram Reactアプリケーションの全体的な構造、主要コンポーネントの役割、画面遷移、状態管理の方針を定義する。  
* 【資料1/8】で定義されたアーキテクチャと、【資料2/8】で定義されたデータモデルをフロントエンドに実装するための基礎設計を提供する。  
* ビジュアルデザインの基本原則を定義し、すりガラス効果を用いた幻想的でミニマルなUIの方向性を示す。  
* AIエージェント（LLM）がこの仕様書を読み込み、アプリケーションの骨格となるApp.tsxや主要コンポーネントのファイル構造、基本的なPropsの受け渡しを実装できるようにする。

**参照資料:**

* 【資料1/8】システム概要とアーキテクチャ設計書  
* 【資料2/8】データベース設計書 (engram\_database\_design.ts)  
* 既存のReactコンポーネントファイル群 (App.tsx, MainPage.tsx など)  
* デザイン指示画像 (d.png, l.png)

## **1\. 全体構造**

* **フレームワーク:** React (v18+) with TypeScript  
* **ビルドツール:** Vite  
* **アーキテクチャ:** シングルページアプリケーション (SPA)  
* **主要コンポーネント:** App.tsx をアプリケーション全体のルートとし、状態管理と画面遷移のハブとして機能させる。各画面は独立したページコンポーネント (MainPage.tsx, NotesPage.tsx など) として実装する。

## **2\. ビジュアルデザイン基本原則**

* **全体テーマ:** 幻想的、シンプル、ミニマル、品のあるデザイン。思考の繋がりを邪魔しない、落ち着いたインターフェースを目指す。  
* **主要効果:** **すりガラス効果 (Glassmorphism / Frosted Glass)** を主要なUI要素（カード、ヘッダー、サイドナビ、モーダル）の背景に適用する。これにより、背景との間に奥行きと軽やかさを生み出す。CSSクラス glass-card を共通スタイルとして定義し、適用する。  
* **レイアウト:**  
  * 十分な余白 (Whitespace) を確保し、情報密度を適切に保つ。  
  * モバイルファーストのアプローチで設計し、デスクトップまで対応するレスポンシブデザインとする。  
* **カラーパレット:**  
  * **Lightモード:** 白に近い明るい背景に、半透明の白のすりガラス要素、濃いグレーのテキストとアイコン。アクセントカラーは控えめに使用。(l.png参照)  
  * **Darkモード:** 黒に近い暗い背景に、半透明の濃いグレーのすりガラス要素、明るいグレーのテキストとアイコン。(d.png参照)  
  * **Systemモード:** OSの設定に応じてLight/Darkモードを自動で切り替える。  
  * ThemeSelectorModal.tsx でユーザーが選択可能にする。App.tsx でテーマの状態を管理し、\<body\> タグに light-theme または dark-theme クラスを付与して全体に適用する。  
* **タイポグラフィ:**  
  * フォントファミリー: Inter または類似の可読性が高く癖のないサンセリフ体フォントを使用する。  
  * フォントサイズとウェイト: 階層構造を明確にしつつ、全体的にシンプルに保つ。  
* **アイコン:** Material Symbols Outlined を一貫して使用する。  
* **インタラクション:**  
  * ボタンホバー、要素の表示/非表示などのアニメーションは、0.2s～0.3s程度のease-in-outトランジションを使用し、滑らかで控えめにする。  
  * InsightBloomAnimation.tsx のような、コンセプトを表現するアニメーションは効果的に使用するが、過度にならないように注意する。

## **3\. 主要コンポーネント構成と役割**

src/  
├── App.tsx             \# ルートコンポーネント、状態管理、ルーティング  
├── main.tsx            \# アプリケーションのエントリーポイント  
├── index.css           \# グローバルスタイル、テーマ変数  
├── db.ts               \# Dexieデータベース定義 (資料2/8参照)  
├── firebase.ts         \# Firebase設定と関数呼び出し  
├── similarity.ts       \# コサイン類似度計算ロジック  
├── components/         \# 再利用可能なUIコンポーネント  
│   ├── AppHeader.tsx       \# 上部ヘッダー (タイトル、ナビアイコン)  
│   ├── SideNav.tsx         \# 左側ナビゲーションメニュー  
│   ├── NoteInput.tsx       \# ノート入力エリア (マルチモーダル)  
│   ├── NoteCard.tsx        \# ノート表示用カード (NotesPage, ProjectPageで使用)  
│   ├── RelationCard.tsx    \# 繋がり表示用カード (ConnectionsPageで使用)  
│   ├── InsightCard.tsx     \# Insight管理用カード (InsightsPageで使用)  
│   ├── ProjectCard.tsx     \# プロジェクト表示用カード (NotesPageで使用)  
│   ├── TaskItem.tsx        \# タスク表示用アイテム (NotesPage, ProjectPageで使用)  
│   ├── CommandPalette.tsx  \# コマンドパレットUI (複合機能)  
│   ├── WorkshopInputModal.tsx \# Workshopノート入力モーダル (複合機能)  
│   ├── GraphView.tsx       \# React Flowグラフ表示 (複合機能)  
│   ├── OnboardingModal.tsx \# 初回起動時オンボーディング (複合機能)  
│   ├── ThemeSelectorModal.tsx \# テーマ選択モーダル  
│   └── HelpModal.tsx       \# ヘルプモーダル  
│   └── ... (その他共通コンポーネント: Button, Modal, Spinner等)  
├── pages/              \# 各画面に対応するコンポーネント  
│   ├── MainPage.tsx        \# ホーム画面 (ノート入力 \+ ACE対話)  
│   ├── NotesPage.tsx       \# ノート一覧画面 (全ノート or プロジェクト外ノート)  
│   ├── ConnectionsPage.tsx \# 繋がり一覧画面 (リスト or グラフビュー)  
│   ├── InsightsPage.tsx    \# Insight管理画面 (フィードバック)  
│   ├── ProjectPage.tsx     \# プロジェクト詳細画面 (複合機能)  
│   ├── ArchivePage.tsx     \# アーカイブ済みノート一覧画面 (複合機能)  
│   └── SettingsPage.tsx    \# 設定画面 (テーマ選択など)  
├── hooks/              \# カスタムフック  
│   └── useSpeechRecognition.ts \# Web Speech APIラッパー  
└── assets/             \# 画像などの静的アセット

**主要コンポーネントの役割:**

* **App.tsx:**  
  * アプリケーション全体のレイアウト（ヘッダー、サイドナビ、メインコンテンツ）を定義する。  
  * 主要な状態（view, theme, isNavOpen, modalNote, isAiWorking, isAceWorking など）を useState で管理する。  
  * useLiveQuery (Dexie) を使用してデータベースからデータを取得し、ページコンポーネントに渡す。  
  * ページ遷移ロジック (handleNavigate) を実装する。  
  * データベース操作関数 (addNote, deleteRelation, updateNoteStatus など) を定義し、子コンポーネントにコールバックとして渡す。  
  * AI関連ロジック (getInsightSuggestions, callAceFlow, バックグラウンド処理 useEffect など) を実装する。  
  * モーダル表示ロジック (handleFeedbackClick, openSettingsModal など) を実装する。  
  * テーマ切り替えロジックを実装し、\<body\> タグにクラスを適用する。  
* **AppHeader.tsx:**  
  * 現在の view 状態に応じて、メニューボタンまたは戻るボタンを表示する。  
  * アプリケーションタイトルまたはページタイトルを表示する。  
  * ヘルプボタン、ノートビュー切り替えボタンなどを表示する。  
  * glass-card スタイルを適用する。  
* **SideNav.tsx:**  
  * 各ページへのナビゲーションリンクを提供する。  
  * 設定画面へのリンクを提供する。  
  * glass-card スタイルを適用する。  
* **ページコンポーネント (pages/\*):**  
  * App.tsx から渡されたデータを表示する責務を持つ。  
  * ユーザーインタラクション（ボタンクリック、スクロールなど）に応じて App.tsx のコールバック関数を呼び出す。  
  * NotesPage, ConnectionsPage は無限スクロール (IntersectionObserver) を実装する。  
  * ConnectionsPage は将来的に GraphView.tsx を使用した表示に切り替える。  
  * ProjectPage は特定の projectId に紐づくノートとタスクを表示する。

## **4\. 画面遷移**

* **主要な画面:** main, notes, connections, insights, project, archive, settings。  
* **遷移トリガー:**  
  * SideNav.tsx のリンククリック → App.tsx の handleNavigate(view) を呼び出し、view 状態を更新。  
  * AppHeader.tsx の戻るボタンクリック → App.tsx の handleBackClick() (内部で setView('main')) を呼び出し。  
  * NotesPage.tsx でプロジェクトカードをクリック → App.tsx の handleNavigate('project', projectId) を呼び出し。  
* **状態管理:** 現在表示している画面は App.tsx の view 状態 (useState\<View\>) で管理する。プロジェクト表示の場合は、currentProjectId (useState\<string | null\>) も併せて管理する。

## **5\. 状態管理方針**

* **グローバル状態:** アプリケーション全体で共有する必要がある状態（現在のview、テーマ設定、認証状態（将来）、DBから取得した主要データなど）は、App.tsx で useState を使用して管理し、Props Drilling または React Context API を介して子コンポーネントに渡す。  
* **ローカル状態:** 特定のコンポーネント内でのみ使用される状態（例: NoteInput.tsx の入力内容、モーダルの開閉状態）は、そのコンポーネント内で useState を使用して管理する。  
* **サーバーキャッシュ状態:** Dexie.jsから取得するデータは useLiveQuery フックを使用することで、DBの変更が自動的にUIに反映されるようにする。これにより、手動でのデータ再取得やキャッシュ管理の複雑さを回避する。  
* **非同期処理の状態:** AIの処理中（isAiWorking, isAceWorking）を示す boolean フラグを App.tsx で管理し、UIにスピナーなどを表示するために使用する。

## **6\. LLMへの実装指示**

* この設計書に基づき、src/ ディレクトリ以下に必要なファイルとフォルダ構造を作成してください。  
* App.tsx を実装し、主要な状態変数、画面遷移ロジックの骨格、および各ページコンポーネントを条件付きでレンダリングする部分 (renderContent) を作成してください。  
* AppHeader.tsx と SideNav.tsx を、指定された役割とデザイン原則（特に glass-card スタイル）に従って実装してください。  
* 各ページコンポーネント (pages/\*.tsx) の基本的なファイルを作成し、App.tsx から必要な Props を受け取るインターフェースを定義してください（内部の実装は【資料4/8】で行います）。  
* index.css に、テーマ変数（Light/Darkの配色）、基本的なリセットスタイル、および glass-card のスタイル定義を含めてください。