# **4.en:gram 主要UIコンポーネント詳細設計書**

バージョン: 1.0  
作成日: 2025-10-29  
**目的:**

* 【資料3/8】で特定された主要なReactコンポーネントについて、内部構造、状態管理、イベントハンドリング、およびスタイリングの詳細を定義する。  
* 「すりガラス (Glassmorphism)」効果を含む、幻想的でミニマルなデザイン原則を具体的なCSS実装レベルで指示する。  
* AIエージェント（LLM）がこの仕様書を読み込み、各コンポーネントの.tsxファイルと関連するCSS（またはTailwindクラス）を実装できるようにする。

**参照資料:**

* 【資料1/8】システム概要とアーキテクチャ設計書  
* 【資料2/8】データベース設計書 (engram\_database\_design.ts)  
* 【資料3/8】フロントエンド基本設計書 (engram\_frontend\_basic\_design.md)  
* デザイン指示画像 (d.png, l.png)  
* 既存のReactコンポーネントファイル群 (実装の参考として)

## **1\. グローバルスタイル (index.css)**

* **テーマ変数:** LightモードとDarkモードの配色を変数として定義する (:root と body.dark-theme セレクタを使用)。  
  * \--background-color: ページ全体の背景色 (Light: \#f8f9fa, Dark: \#121212)  
  * \--glass-background-color: すりガラス要素の背景色 (Light: rgba(255, 255, 255, 0.6), Dark: rgba(40, 40, 40, 0.7))  
  * \--text-color-primary: 主要なテキスト色 (Light: \#212529, Dark: \#e9ecef)  
  * \--text-color-secondary: 副次的なテキスト色 (Light: \#6c757d, Dark: \#adb5bd)  
  * \--border-color: すりガラス要素の境界線色 (Light: rgba(255, 255, 255, 0.8), Dark: rgba(60, 60, 60, 0.8))  
  * \--accent-color: 主要なアクセントカラー (例: \#007bff)  
  * \--icon-button-background: アイコンボタンの背景色 (Light: rgba(0, 0, 0, 0.05), Dark: rgba(255, 255, 255, 0.1))  
  * \--icon-button-hover-background: アイコンボタンのホバー時背景色 (Light: rgba(0, 0, 0, 0.1), Dark: rgba(255, 255, 255, 0.2))  
* **基本スタイル:**  
  * body に font-family: 'Inter', sans-serif; を設定。  
  * margin, padding のリセット。  
  * box-sizing: border-box; を全体に適用。  
  * スムーズなスクロール (scroll-behavior: smooth;)。  
* **.glass-card スタイル:**  
  * background-color: var(--glass-background-color);  
  * backdrop-filter: blur(10px); (すりガラス効果の核)  
  * \-webkit-backdrop-filter: blur(10px); (Safari用プレフィックス)  
  * border-radius: 12px; (角丸)  
  * border: 1px solid var(--border-color); (細い境界線)  
  * box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); (わずかな影)  
  * padding: 16px; (デフォルトの内部余白)  
  * margin-bottom: 16px; (カード間のデフォルトマージン)

## **2\. App.tsx (レイアウトとモーダル)**

* **レイアウト:**  
  * div.app-shell をFlexboxまたはGridで構成し、AppHeader, SideNav (画面幅に応じて表示/非表示), main.main-content を配置。  
  * main.main-content はヘッダー分の padding-top を持ち、画面の主要領域を占める。  
* **モーダル実装:**  
  * ThemeSelectorModal, HelpModal, note-modal (ACE参照ノート用) は、画面全体を覆う半透明のバックドロップ (.modal-backdrop) と、中央に表示されるコンテンツエリア (.modal-content.glass-card) で構成する。  
  * モーダル表示時は App.tsx の useState (例: showNoteModal) を true にする。  
  * **ACE参照ノート用モーダル (`note-modal`) のロジック:**  
    * ACE応答 (`aceResponse`) 内に `Ref: <noteId>` のパターンを検出した場合、その `noteId` を抽出し、対応するノートをデータベース (`db.notes.get(noteId)`) またはプレイブック (`getPlaybookNote(noteId)`) から取得する。  
    * 取得したノートを `selectedNoteForModal` ステートに設定し、モーダルを表示する。  
  * バックドロップクリックまたは閉じるボタン (X) クリックで useState を false にする `onClose` 関数を実装。  
  * **アクセシビリティ:** モーダルには `aria-modal="true"` および `role="dialog"` を設定し、キーボードナビゲーション (Tabキーでのフォーカス移動、Escキーでの閉じる動作) を考慮する。  
  * **セマンティクス:** 閉じるボタンには `close-button` のようなセマンティックなクラス名を使用し、`submit-button` のような不適切なクラス名は避ける。

## **3\. components/AppHeader.tsx**

* **構造:** Flexboxを使用し、header-left (メニュー/戻るボタン), header-center (タイトル), header-right (その他アイコン) の3つの領域で構成。  
* **スタイリング:**  
  * ヘッダー自体に .glass-card スタイルを適用 (ただし border-radius は下部のみ、または無し)。  
  * 高さは固定 (例: 60px)。  
  * アイコンボタン (.header-icon-button) は背景なし、ホバー時に var(--icon-button-hover-background) を適用。padding を適切に設定。  
  * タイトル (.header-title, .header-page-title) は中央揃え、適切な font-size と font-weight を設定。

## **4\. components/SideNav.tsx**

* **構造:**  
  * 画面全体を覆うバックドロップ (.sidenav-backdrop) と、左からスライドインするパネル (.sidenav-panel.glass-card) で構成。  
  * パネル内部はヘッダー (.sidenav-header) とナビゲーションリンク (.sidenav-nav) を含む。  
* **スタイリング:**  
  * パネルに .glass-card スタイルを適用。幅は固定 (例: 280px)。  
  * transform: translateX(-100%) と transition: transform 0.3s ease-in-out を使用して開閉アニメーションを実装。.open クラスで transform: translateX(0) にする。  
  * ナビゲーションリンク (.sidenav-link) はFlexboxでアイコンとテキストを配置。ホバー効果とアクティブ状態 (.active) のスタイルを定義。

## **5\. components/NoteInput.tsx**

* **構造:** form.note-input-wrapper 内に、メイン入力エリア (.main-input-area) とアクションバー (.actions-bar) を配置。  
  * .main-input-area には \<textarea\>, 画像プレビュー (.file-preview), カメラビュー (.camera-view) が条件付きで表示される。  
  * .actions-bar はFlexbox (justify-content: space-between) で、左側にツールボタン (.tool-buttons)、右側に送信ボタン (.send-button) を配置。  
* **スタイリング:**  
  * 全体に .glass-card を適用（padding は少なめか無しにする）。  
  * \<textarea\> は border: none, background: transparent, resize: none とし、font-size, color を適切に設定。  
  * 画像プレビュー、カメラビューは適切なアスペクト比で表示。  
  * アイコンボタン (.icon-button) は円形 (border-radius: 50%) または角丸四角形。背景は var(--icon-button-background)、ホバー時は var(--icon-button-hover-background)。アクティブ状態 (.active, 例: マイク録音中) は var(--accent-color) や異なる背景色で示す。  
  * 送信ボタンは目立つように少し大きく、アクセントカラーを使用してもよい。  
  * AI処理中のスピナー (.spinner) を .main-input-area 内にオーバーレイ表示。

## **6\. pages/NotesPage.tsx & components/NoteCard.tsx**

* **NotesPage.tsx 構造:**  
  * .notes-page-container 内に NoteCard コンポーネントをマップ表示。  
  * .notes-page-container は display: grid (grid-view モード時) または display: flex; flex-direction: column; (list-view モード時) を切り替える。  
  * 無限スクロール用の不可視のトリガー要素 (.load-more-button) を末尾に配置。  
* **NoteCard.tsx 構造:**  
  * .note-card.glass-card をルート要素とする。  
  * 右上に削除ボタン (.delete-button) またはアーカイブボタン (.archive-button) を配置。  
  * ピン留めアイコン (.pin-icon) を左上に配置（isPinned が true の場合）。  
  * コンテンツエリア (.note-content) にテキスト (\<p\>) または画像 (\<img\>) を表示。  
  * 下部に作成日時 (\<small\>) と関連ノートバッジ (.connections-badge) を表示。  
* **NoteCard.tsx スタイリング:**  
  * .glass-card を適用。  
  * grid-view 時は固定幅、list-view 時は幅 100%。  
  * 画像は max-width: 100%, height: auto, border-radius を設定。  
  * テキストは適切な行数制限と overflow: hidden を設定。  
  * ピン留め、アーカイブ、削除ボタンは絶対配置でカードの角に配置。  
  * ホバー時にわずかにスケールアップするなどのインタラクションを追加。

## **7\. pages/ConnectionsPage.tsx (グラフビュー版) & components/GraphView.tsx**

* **ConnectionsPage.tsx 構造:**  
  * 全画面を占めるコンテナ (.connections-graph-container) を用意。  
  * GraphView.tsx コンポーネントをレンダリングする。  
* **GraphView.tsx 構造 (React Flow):**  
  * @xyflow/react をインポート。  
  * ReactFlowProvider でラップ。  
  * ReactFlow コンポーネントを使用し、nodes と edges を渡す。  
  * Background コンポーネントで背景（ドットなど）を表示。  
  * Controls コンポーネントでズーム/パン操作UIを表示。  
  * ノード (Note を表現) とエッジ (Relation を表現) のカスタムコンポーネントを定義 (customNode, customEdge)。  
* **スタイリング:**  
  * カスタムノードは .glass-card スタイルを適用した小さなカードとし、ノート内容の冒頭を表示。ノードの色や形で NoteType を表現してもよい。  
  * エッジは Relation の strength (提案) に応じて太さや破線/実線を変更。  
  * 全体の背景はテーマカラーに合わせる。

## **8\. pages/MainPage.tsx (ACE対話エリア)**

* **構造:**  
  * .main-page-content 内に .note-input-card と .ace-section.glass-card を配置。  
  * .ace-section 内に、入力エリア (.ace-input-area) と応答表示エリア (.ace-response.glass-card) を配置。  
  * .ace-input-area は \<textarea\> と送信ボタンを配置。  
  * .ace-response は ReactMarkdown で結果を表示。参照ノートボタン (.feedback-note-button) を含む。  
* **スタイリング:**  
  * 各セクションに .glass-card を適用。  
  * ACE応答 (.ace-response) は、AIが洞察を生成している間 (getInsightSuggestions が動作している間、App.tsx から渡される `isInsightWorking` フラグなどを使用) に InsightBloomAnimation.tsx がオーバーレイ表示され、応答が返るとアニメーションがフェードアウトし、応答内容がフェードインするようなトランジションを実装（opacity と transition を使用）。  
  * ACEエラー表示 (.error-card) は背景色を赤系にするなど、視覚的に区別する。エラーメッセージはユーザーに分かりやすい形で提示する。  
  * 参照ノートボタンは小さく目立たないスタイルにする。

## **9\. components/CommandPalette.tsx (複合機能)**

* **構造:**  
  * 画面中央上部に表示されるモーダル形式。ルート要素は .command-palette.glass-card。  
  * 内部に \<input type="text"\> の検索ボックスと、検索結果を表示するリスト (.results-list) を含む。  
* **スタイリング:**  
  * .glass-card を適用。  
  * position: fixed, top: 10%, left: 50%, transform: translateX(-50%) で中央上部に配置。  
  * z-index を高く設定。  
  * 検索結果リストの各項目にホバー効果と選択状態のスタイルを定義。

## **10\. components/WorkshopInputModal.tsx (複合機能)**

* **構造:** フルスクリーンに近い大型モーダル。.workshop-modal-content.glass-card をルート要素とする。  
  * 内部はGridレイアウト等を使用し、テキスト入力エリア、スケッチパッド (例: react-sketch-canvas)、画像アップロードエリア、3Dモデルアップロードエリア、音声録音ボタンを配置。  
* **スタイリング:**  
  * .glass-card を適用。  
  * 各入力エリアは明確に区切る。  
  * スケッチパッドや3Dビューアは指定された領域内に収まるようにする。

## **11\. components/OnboardingModal.tsx (複合機能)**

* **構造:** アプリケーションの上にオーバーレイ表示されるモーダル。ステップバイステップでUI要素をハイライトし、説明文を表示する形式。  
* **スタイリング:**  
  * ハイライトされるUI要素以外は暗くするバックドロップを使用。  
  * 説明文の吹き出しは .glass-card スタイルを適用。  
  * 「次へ」「完了」ボタンを配置。

## **12\. LLMへの実装指示**

* 上記の各コンポーネントについて、指定された構造、状態管理、イベントハンドリング、スタイリング（特に .glass-card とテーマ変数、レスポンシブ対応）を実装する .tsx ファイルと、対応する .css ファイル（またはインラインスタイル、CSS Modules、Tailwindクラスなど）を作成してください。  
* 【資料3/8】で定義されたコンポーネント構成に従い、Props を適切に受け渡ししてください。  
* スタイリングは、提示された画像 (d.png, l.png) の雰囲気と、デザイン原則「幻想的、シンプル、ミニマル、品のある」を再現するように実装してください。